spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      server:
        webflux:
          routes:
            - id: login
              uri: no://op
              predicates:
                - Path=${application.rest.authentication.path:/api/v1/auth}/login
                - Method=POST
              filters:
                - KeycloakAuthentication
            - id: logout
              uri: no://op
              predicates:
                - Path=${application.rest.authentication.path:/api/v1/auth}/logout
                - Method=POST
              filters:
                - KeycloakLogout
            - id: refresh
              uri: no://op
              predicates:
                - Path=${application.rest.authentication.path:/api/v1/auth}/refresh
                - Method=POST
              filters:
                - KeycloakRefresh
            - id: user
              uri: no://op
              predicates:
                - Path=${application.rest.authentication.path:/api/v1/auth}/user
                - Method=GET
              filters:
                - KeycloakUserInfo
            - id: validate
              uri: no://op
              predicates:
                - Path=${application.rest.authentication.path:/api/v1/auth}/validate
                - Method=GET
              filters:
                - KeycloakValidate
            - id: complete-registration
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/auth/complete-registration
                - Method=POST
            - id: users-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/users/**
                - Method=GET,POST,PUT,PATCH,DELETE
            - id: interns-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/interns/**
            - id: mentors-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/mentors/**
            - id: departments-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/departments/**
            - id: tasks-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/tasks/**
            - id: assessments-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/assessments/**
            - id: ratings-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/ratings/**
            - id: internship-programs-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/internship-programs/**
            - id: roadmaps-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/roadmaps/**
            - id: reports-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/reports/**
            - id: dashboard-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/dashboard/**
            - id: trainee-service
              uri: ${TRAINEE_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/trainee/**
            - id: notification-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/notification/**
              filters:
                - StripPrefix=2
            - id: mailings-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/mailings/**
              filters:
                - StripPrefix=2
            - id: recipients-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/recipients/**
              filters:
                - StripPrefix=2
            - id: email-templates-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/email-templates/**
              filters:
                - StripPrefix=2
            - id: distribution-groups-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/distribution-groups/**
              filters:
                - StripPrefix=2
            - id: in-app-notifications-service
              uri: ${NOTIFICATION_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/in-app-notifications/**
              filters:
                - StripPrefix=2
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:growpath}
          jwk-set-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:growpath}/protocol/openid-connect/certs

application:
  rest:
    authentication:
      path: /api/v1/auth

keycloak:
  client:
    id: ${KEYCLOAK_CLIENT_ID:api-gateway}
    secret: ${KEYCLOAK_CLIENT_SECRET:api-gateway-secret}

cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173,http://localhost:8081,http://localhost:8080}
  allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS,PATCH}
  allowed-headers: ${CORS_ALLOWED_HEADERS:Content-Type,Authorization,Accept,X-Requested-With,Origin,Access-Control-Request-Method,Access-Control-Request-Headers}
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}

server:
  port: ${API_GATEWAY_PORT:8080}

management:
  endpoints:
    web:
      exposure:
        include: health,info,gateway

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    org.springframework.security: DEBUG

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operationsSorter: method
    tagsSorter: alpha
    tryItOutEnabled: true
